# Claude Memo 设计文档

**日期**: 2026-01-29

## 概述

**名称**: claude-memo

**定位**: Claude Code 会话记录管理工具

**目标**: 高效搜索、收藏、分享 Claude Code 的会话记录

## 核心功能

| 功能 | 描述 |
|------|------|
| 搜索 | 全文检索 + 高级过滤（项目、时间、sessionId） |
| 收藏 | 将重要的会话标记收藏，支持标签管理 |
| 分享 | 导出为 HTML 格式，支持截图分享 |

## 数据架构

### 数据源

```
~/.claude/history.jsonl          # 官方会话记录（只读）
```

`history.jsonl` 格式示例:
```json
{"display":"/model ","pastedContents":{},"timestamp":1766567616338,"project":"/Users/yym","sessionId":"d55aaa1c-b149-4aa4-9809-7eab1dba8d4c"}
```

字段说明:
- `display`: 命令/消息内容
- `timestamp`: 时间戳（毫秒）
- `project`: 项目路径
- `sessionId`: 会话唯一标识

### 存储位置

```
~/.claude-memo/                   # 应用数据目录
├── index/                        # 搜索索引
│   └── *.sqlite                  # SQLite FTS5 索引
├── favorites/                    # 收藏数据
│   └── *.toml                    # 收藏夹配置
└── tags/                         # 标签数据
    └── *.toml                    # 标签关联配置
```

## 模块设计

```
┌─────────────────────────────────────────────────────┐
│                    claude-memo                       │
├─────────────────────────────────────────────────────┤
│  parser/                                             │
│    └─ history.jsonl → 结构化会话数据                  │
├─────────────────────────────────────────────────────┤
│  indexer/                                            │
│    └─ 构建 SQLite FTS5 全文索引                      │
├─────────────────────────────────────────────────────┤
│  storage/                                            │
│    └─ ~/.claude-memo/ 读写管理                       │
├─────────────────────────────────────────────────────┤
│  search/                                             │
│    └─ 处理搜索查询和过滤                              │
├─────────────────────────────────────────────────────┤
│  exporter/                                           │
│    └─ HTML 渲染和截图生成                            │
├─────────────────────────────────────────────────────┤
│  cli/                                                │
│    └─ 命令行界面（交互式 + 非交互）                   │
└─────────────────────────────────────────────────────┘
```

## 实现优先级

### 第一阶段（核心原型）

- [ ] 解析 `history.jsonl`
- [ ] 基础搜索（文本匹配）
- [ ] 收藏/取消收藏
- [ ] 单元测试验证

### 第二阶段（增强）

- [ ] 高级搜索（字段过滤、时间范围）
- [ ] 导出为 HTML
- [ ] 标签系统

### 第三阶段（外壳）

- [ ] 交互式 CLI（fzf 风格）
- [ ] 截图功能

## 搜索语法

支持全文检索和高级过滤：

```
# 全文搜索
keyword                    # 包含 keyword 的记录

# 字段过滤
project:/Users/yym/workspace/project  # 特定项目
session:abc123             # 特定会话
last:7d                    # 最近 7 天
last:1h                    # 最近 1 小时

# 组合查询
project:/Users/yym/workspace project:claude keyword
```

## 技术栈

- **语言**: Rust
- **索引**: SQLite FTS5 或 tantivy
- **配置**: TOML
- **CLI**: clap
- **导出**: minify-html, screenshot 或 html2image

## 与项目代码的关系

`.claude-memo/` 目录应加入各项目仓库的 `.gitignore`。
